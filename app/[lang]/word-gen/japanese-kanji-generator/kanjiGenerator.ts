/**
 * 日本語漢字ジェネレーターのユーティリティ関数
 */

// 日本の常用漢字
const JAPANESE_KANJI = [
  '亜', '哀', '挨', '愛', '曖', '悪', '握', '圧', '扱', '宛', '姐', '虻', '安', '暗', '案', '闇', '以', '位', '依', '偉',
  '囲', '夷', '委', '威', '尉', '惟', '意', '慰', '易', '椅', '為', '畏', '異', '移', '維', '緯', '胃', '衣', '謂', '違',
  '遺', '医', '井', '域', '育', '一', '壱', '溢', '逸', '稲', '茨', '芋', '引', '印', '咽', '員', '因', '姻', '院', '淫',
  '陰', '飲', '隠', '韻', '右', '宇', '烏', '羽', '雨', '唄', '鬱', '畝', '浦', '瓜', '噂', '云', '運', '雲', '荏', '餌',
  '営', '影', '映', '栄', '永', '泳', '洩', '英', '衛', '詠', '鋭', '液', '疫', '益', '駅', '悦', '越', '謁', '閲', '榎',
  '厭', '円', '園', '堰', '奄', '宴', '延', '怨', '援', '沿', '演', '炎', '焔', '煙', '燕', '猿', '縁', '艶', '遠', '鉛',
  '鴛', '塩', '於', '汚', '甥', '凹', '央', '奥', '往', '応', '押', '旺', '欧', '殴', '王', '黄', '岡', '沖', '荻', '億',
  '屋', '憶', '臆', '桶', '牡', '乙', '俺', '卸', '恩', '温', '穏', '音', '下', '化', '仮', '何', '伽', '価', '佳', '加',
  '可', '嘉', '夏', '嫁', '家', '寡', '科', '暇', '果', '架', '歌', '河', '火', '禍', '稼', '箇', '花', '苛', '茄', '荷',
  '華', '菓', '虞', '貨', '迦', '過', '霞', '蚊', '俄', '峨', '我', '牙', '画', '芽', '賀', '雅', '餓', '介', '会', '解',
  '回', '塊', '壊', '廻', '快', '怪', '悔', '恢', '懐', '戒', '拐', '改', '魁', '晦', '械', '海', '灰', '界', '皆', '畦',
  '疥', '皆', '盃', '階', '程', '開', '外', '咳', '害', '崖', '慨', '概', '涯', '蓋', '該', '街', '鎧', '骸', '浬', '柿',
  '核', '殻', '郭', '覚', '較', '角', '拡', '革', '格', '確', '覚', '該', '閣', '隔', '革', '学', '岳', '楽', '額', '顎',
  '掛', '潟', '割', '喝', '括', '活', '渇', '滑', '葛', '割', '喝', '喝', '褐', '轄', '且', '株', '釜', '鎌', '刈', '瓦',
  '乾', '冠', '寒', '刊', '勘', '巻', '喚', '堪', '完', '官', '寛', '干', '幹', '患', '感', '慣', '換', '敢', '柑', '桓',
  '棺', '款', '歓', '汗', '環', '甘', '監', '看', '竿', '管', '簡', '緩', '缶', '肝', '艦', '観', '貫', '還', '鑑', '間',
  '閑', '関', '陥', '韓', '館', '丸', '含', '岸', '岩', '玩', '眼', '頑', '顔', '願', '企', '伎', '危', '喜', '器', '基',
  '奇', '寄', '徽', '季', '岐', '希', '幾', '忌', '揮', '机', '旗', '既', '期', '棋', '棄', '機', '帰', '気', '汽', '畿',
  '祈', '季', '紀', '規', '記', '貴', '起', '軌', '輝', '飢', '騎', '鬼', '亀', '偽', '儀', '戯', '技', '宜', '疑', '欺',
  '義', '疑', '誼', '議', '掬', '菊', '鞠', '吉', '喫', '詰', '却', '客', '脚', '虐', '逆', '丘', '久', '仇', '吸', '宮',
  '弓', '急', '救', '朽', '求', '汲', '泣', '球', '究', '窮', '笈', '級', '糾', '給', '旧', '牛', '去', '仰', '叫', '巷',
  '拒', '拠', '挙', '渠', '虚', '許', '距', '鋸', '漁', '供', '傀', '偶', '寓', '空', '遇', '串', '串', '屈', '掘', '窟',
  '沓', '靴', '熊', '隈', '繰', '勲', '君', '薫', '訓', '群', '軍', '郡', '卦', '袈', '係', '傾', '刑', '兄', '形', '径',
  '恵', '慶', '慧', '桂', '渓', '畦', '稽', '系', '経', '継', '繋', '罫', '茎', '荊', '蛍', '計', '詣', '警', '軽', '頚',
  '鶏', '芸', '迎', '鯨', '劇', '戟', '撃', '激', '隙', '桁', '傑', '欠', '決', '潔', '穴', '結', '血', '訣', '月', '件',
  '倹', '健', '兼', '券', '剣', '喧', '圏', '堅', '嫌', '建', '憲', '懸', '拳', '捲', '検', '権', '牽', '犬', '研', '硯',
  '穴', '絹', '県', '肩', '見', '謙', '賢', '軒', '遣', '鍵', '険', '顕', '験', '鹸', '元', '原', '厳', '幻', '弦', '減',
  '源', '玄', '現', '限', '原', '舷', '言', '誤', '悟', '娯', '悟', '吾', '護', '口', '工', '広', '康', '弘', '恒', '慌',
  '抗', '拘', '控', '攻', '昂', '晃', '更', '杭', '校', '梗', '構', '江', '洪', '溝', '港', '甲', '皇', '硬', '稿', '紅',
  '絞', '綱', '耕', '考', '肯', '肛', '航', '荒', '行', '衡', '講', '貢', '購', '郊', '酵', '鉱', '鋼', '閤', '降', '項',
  '香', '高', '剛', '劫', '号', '合', '壕', '拷', '豪', '克', '刻', '告', '国', '穀', '酷', '黒', '獄', '腰', '骨', '込',
  '頃', '今', '困', '墾', '婚', '恨', '懇', '昆', '根', '混', '痕', '紺', '魂', '佐', '唆', '差', '砂', '詐', '鎖', '座',
  '挫', '債', '催', '再', '最', '塞', '妻', '宰', '彩', '才', '採', '栽', '歳', '済', '災', '采', '砕', '祭', '斎', '細',
  '菜', '裁', '載', '際', '剤', '在', '材', '罪', '財', '坂', '阪', '咲', '崎', '作', '削', '昨', '柵', '策', '索', '錯',
  '桜', '冊', '札', '刷', '殺', '察', '拶', '撮', '擦', '雑', '皿', '三', '傘', '参', '山', '惨', '撒', '散', '桟', '蚕',
  '讃', '賛', '酸', '残', '斬', '暫', '士', '仔', '仕', '伺', '使', '刺', '司', '史', '嗣', '四', '士', '始', '姉', '姿',
  '子', '屍', '市', '師', '志', '思', '指', '支', '孜', '斯', '施', '旨', '枝', '止', '死', '氏', '獅', '祉', '私', '糸',
  '紙', '紫', '肢', '至', '視', '詞', '詩', '試', '誌', '諮', '資', '賜', '雌', '飼', '歯', '事', '似', '侍', '児', '字',
  '寺', '慈', '持', '時', '次', '滋', '治', '爾', '璽', '示', '而', '耳', '自', '蒔', '飾', '軸', '七', '叱', '執', '失',
  '嫉', '室', '湿', '漆', '疾', '質', '実', '蔀', '篠', '偲', '柴', '芝', '屡', '滋', '脂', '誌', '踟', '叱', '四', '篠',
  '詩', '試', '資', '賜', '雌', '飼', '歯', '事', '似', '侍', '児', '字', '寺', '慈', '持', '時', '次', '滋', '治', '爾',
  '示', '耳', '自', '若', '弱', '惹', '主', '取', '守', '手', '朱', '殊', '狩', '珠', '種', '腫', '趣', '寿', '受', '呪',
  '授', '需', '儒', '囚', '収', '周', '宗', '就', '州', '修', '愁', '拾', '洲', '秀', '秋', '終', '習', '臭', '舟', '蒐',
  '衆', '襲', '讐', '蹴', '輯', '週', '酋', '酬', '集', '醜', '什', '住', '充', '十', '従', '戎', '柔', '汁', '渋', '獣',
  '縦', '重', '銃', '叔', '夙', '宿', '淑', '祝', '縮', '粛', '塾', '熟', '出', '術', '述', '俊', '春', '瞬', '旬', '巡',
  '盾', '准', '殉', '純', '循', '順', '準', '処', '初', '所', '暑', '庶', '緒', '書', '署', '諸', '助', '叙', '女', '序',
  '徐', '恕', '鋤', '除', '傷', '償', '勝', '匠', '升', '召', '哨', '商', '唱', '掌', '晶', '焼', '焦', '照', '症', '省',
  '硝', '礁', '祥', '称', '章', '笑', '粧', '紹', '肖', '菖', '蒋', '衝', '裳', '訟', '証', '詔', '詳', '象', '賞', '醤',
  '鐘', '障', '鞘', '上', '丈', '丞', '乗', '冗', '剰', '城', '場', '壌', '嬢', '常', '情', '擾', '条', '杖', '浄', '状',
  '畳', '穣', '蒸', '譲', '醸', '嘱', '埴', '飾', '植', '殖', '燭', '織', '職', '色', '触', '食', '殖', '辱', '尻', '伸',
  '信', '侵', '唇', '娠', '寝', '審', '心', '慎', '新', '晋', '森', '榛', '浸', '深', '申', '疹', '真', '神', '秦', '紳',
  '臣', '芯', '薪', '親', '診', '身', '辛', '進', '針', '震', '人', '仁', '刃', '塵', '壬', '尋', '甚', '尽', '陣', '靭',
  '酔', '吹', '炊', '帥', '粋', '翠', '衰', '遂', '睡', '酔', '錘', '随', '髄', '枢', '趨', '雛', '据', '杉', '椙', '菅',
  '頗', '雀', '裾', '寸', '瀬', '是', '制', '姓', '征', '性', '成', '政', '整', '星', '晴', '棲', '栖', '清', '牲', '生',
  '盛', '精', '製', '誠', '請', '逝', '醒', '青', '静', '斉', '税', '脆', '隻', '席', '惜', '戚', '責', '績', '赤', '跡',
  '蹟', '切', '折', '拙', '接', '摂', '折', '設', '窃', '節', '説', '雪', '絶', '舌', '蝉', '仙', '先', '千', '占', '宣',
  '専', '尖', '川', '戦', '扇', '栓', '泉', '洗', '浅', '染', '潜', '煎', '旋', '穿', '箭', '線', '繊', '羨', '船', '薦',
  '詮', '賎', '践', '選', '遷', '銭', '銑', '閃', '鮮', '前', '善', '漸', '然', '全', '禅', '繕', '膳', '糎', '噌', '塑',
  '岨', '措', '疎', '礎', '祖', '租', '粗', '素', '組', '蘇', '訴', '阻', '僧', '創', '双', '叢', '倉', '喪', '壮', '奏',
  '爽', '巣', '捜', '掃', '曹', '曽', '爽', '窓', '総', '聡', '草', '荘', '葬', '蒼', '藻', '装', '走', '送', '遭', '鎗',
  '騒', '増', '憎', '蔵', '贈', '臓', '即', '束', '足', '促', '則', '息', '捉', '側', '測', '俗', '属', '賊', '族', '続',
  '卒', '袖', '其', '揃', '存', '孫', '尊', '損', '村', '遜', '他', '多', '太', '汰', '詑', '唾', '堕', '妥', '惰', '打',
  '柁', '舵', '駄', '体', '対', '耐', '待', '怠', '胎', '退', '逮', '帯', '泰', '滞', '態', '戴', '大', '替', '台', '滝',
  '瀧', '卓', '啄', '宅', '托', '択', '拓', '沢', '濯', '琢', '託', '鐸', '濁', '諾', '茸', '凧', '但', '達', '脱', '奪',
  '棚', '誰', '丹', '旦', '担', '単', '嘆', '坦', '探', '淡', '短', '歎', '端', '綻', '誕', '鍛', '団', '男', '談', '値',
  '知', '地', '弛', '恥', '智', '池', '痴', '稚', '置', '致', '蜘', '遅', '築', '畜', '竹', '逐', '秩', '窒', '茶', '嫡',
  '着', '中', '仲', '宙', '忠', '抽', '昼', '柱', '注', '虫', '衷', '註', '酎', '鋳', '駐', '著', '貯', '丁', '兆', '凋',
  '喋', '寵', '帖', '帳', '庁', '弔', '張', '彫', '徴', '懲', '挑', '暢', '朝', '潮', '牒', '町', '眺', '聴', '脹', '腸',
  '蝶', '調', '諜', '超', '跳', '銚', '長', '頂', '鳥', '勅', '捗', '直', '朕', '沈', '珍', '賃', '鎮', '陳', '津', '墜',
  '椎', '槌', '追', '鎚', '痛', '通', '塚', '掴', '槻', '佃', '漬', '柘', '辻', '蔦', '綴', '鍔', '椿', '潰', '坪', '壷',
  '爪', '吊', '釣', '鶴', '亭', '低', '停', '偵', '剃', '貞', '呈', '堤', '定', '帝', '底', '庭', '廷', '弟', '悌', '抵',
  '挺', '提', '梯', '汀', '碇', '的', '笛', '適', '滴', '敵', '溺', '哲', '徹', '撤', '轍', '迭', '鉄', '典', '填', '天',
  '展', '店', '添', '纏', '田', '伝', '殿', '澱', '舐', '砥', '砺', '努', '度', '土', '奴', '怒', '倒', '党', '冬', '凍',
  '刀', '唐', '塔', '塘', '套', '宕', '島', '盗', '稲', '討', '踏', '藤', '謄', '闘', '働', '動', '同', '堂', '導', '憧',
  '瞳', '童', '到', '董', '蕩', '凍', '搭', '答', '塔', '湯', '痘', '登', '答', '等', '筒', '糖', '統', '到', '踏', '謄',
  '藤', '豆', '頭', '闘', '働', '銅', '導', '読', '督', '徳', '特', '得', '毒', '独', '読', '栃', '凸', '突', '届', '屯',
  '豚', '遁', '頓', '貪', '鈍', '奈', '那', '内', '謎', '納', '梨', '那', '鳴', '捺', '鍋', '南', '軟', '難', '二', '尼',
  '弐', '匂', '肉', '虹', '日', '乳', '入', '尿', '任', '妊', '忍', '認', '寧', '熱', '年', '念', '捻', '粘', '燃', '悩',
  '濃', '納', '能', '脳', '覗', '農', '把', '波', '派', '破', '覇', '馬', '婆', '排', '廃', '拝', '排', '敗', '杯', '背',
  '肺', '俳', '配', '倍', '培', '媒', '梅', '買', '売', '賠', '陪', '這', '伯', '剥', '博', '拍', '泊', '白', '箔', '粕',
  '舶', '薄', '迫', '曝', '漠', '爆', '縛', '麦', '箱', '箸', '畑', '肌', '八', '鉢', '発', '髪', '伐', '抜', '罰', '閥',
  '反', '半', '氾', '帆', '汎', '伴', '判', '坂', '阪', '板', '版', '班', '畔', '搬', '般', '販', '晩', '番', '盤', '蛮',
  '卑', '否', '妃', '彼', '披', '泌', '疲', '皮', '碑', '秘', '被', '扉', '非', '悲', '費', '飛', '備', '微', '鼻', '匹',
  '疋', '必', '筆', '姫', '百', '氷', '漂', '票', '表', '標', '秒', '描', '病', '品', '浜', '貧', '賓', '頻', '敏', '瓶',
  '不', '付', '埠', '夫', '婦', '富', '布', '府', '怖', '扶', '敷', '普', '浮', '父', '符', '腐', '膚', '譜', '賦', '赴',
  '阜', '附', '侮', '撫', '武', '舞', '部', '封', '風', '伏', '服', '副', '復', '幅', '福', '腹', '複', '覆', '払', '沸',
  '仏', '物', '粉', '紛', '雰', '文', '聞', '丙', '併', '並', '柄', '陛', '塀', '幣', '弊', '蔽', '閉', '陛', '米', '壁',
  '癖', '別', '蔑', '偏', '変', '片', '編', '辺', '返', '遍', '便', '勉', '娩', '弁', '保', '舗', '捕', '歩', '補', '輔',
  '穂', '募', '墓', '慕', '暮', '母', '簿', '倣', '俸', '包', '胞', '報', '奉', '宝', '抱', '放', '法', '泡', '烹', '砲',
  '縫', '胞', '芳', '訪', '邦', '飽', '豊', '飽', '褒', '縫', '亡', '乏', '忙', '坊', '妨', '房', '某', '冒', '剖', '紡',
  '肪', '膨', '謀', '防', '妨', '帽', '忘', '棒', '望', '奉', '亡', '暴', '望', '牧', '睦', '僕', '墨', '撲', '朴', '牧',
  '睦', '北', '木', '僕', '勃', '没', '堀', '本', '奔', '翻', '凡', '盆', '麻', '埋', '妹', '枚', '毎', '哩', '万', '満',
  '漫', '慢', '味', '未', '魅', '巳', '箕', '密', '蜜', '脈', '妙', '民', '眠', '務', '夢', '無', '矛', '霧', '娘', '名',
  '命', '明', '盟', '迷', '銘', '鳴', '滅', '免', '棉', '綿', '面', '麺', '模', '茂', '妄', '猛', '盲', '網', '耗', '毛',
  '木', '黙', '目', '餅', '問', '悶', '紋', '門', '野', '矢', '夜', '爺', '耶', '弥', '厄', '役', '約', '薬', '訳', '躍',
  '靖', '柳', '愉', '油', '癒', '諭', '輸', '唯', '友', '有', '勇', '幽', '悠', '郵', '湧', '猶', '裕', '誘', '遊', '憂',
  '優', '雄', '有', '祐', '幼', '容', '庸', '揚', '揺', '擁', '曜', '様', '洋', '溶', '熔', '用', '羊', '葉', '陽', '養',
  '要', '謡', '踊', '遥', '抑', '欲', '沃', '浴', '翌', '翼', '淀', '羅', '裸', '来', '雷', '頼', '絡', '落', '酪', '辣',
  '濫', '藍', '欄', '吏', '利', '里', '理', '璃', '痢', '裏', '履', '李', '梨', '離', '陸', '律', '率', '立', '略', '柳',
  '龍', '粒', '隆', '硫', '流', '溜', '琉', '留', '竜', '粒', '虜', '慮', '了', '両', '涼', '猟', '量', '陵', '良', '料',
  '梁', '遼', '僚', '寮', '療', '瞭', '糧', '領', '力', '緑', '林', '厘', '倫', '隣', '臨', '輪', '麟', '涙', '累', '塁',
  '類', '令', '伶', '例', '冷', '励', '嶺', '怜', '玲', '礼', '苓', '鈴', '隷', '零', '霊', '齢', '麗', '暦', '歴', '列',
  '劣', '烈', '裂', '廉', '恋', '練', '蓮', '連', '錬', '呂', '炉', '賂', '路', '露', '労', '婁', '廊', '朗', '楼', '漏',
  '籠', '六', '録', '麓', '論', '和', '話', '歪', '賄', '脇', '惑', '枠', '鷲', '亙', '湾', '腕'
];


/**
 * ランダムな漢字を生成する
 * @returns ランダムに生成された漢字
 */
export function generateRandomKanji(): string {
  // 常用漢字配列からランダムに一つ選択
  const randomIndex = Math.floor(Math.random() * JAPANESE_KANJI.length);
  return JAPANESE_KANJI[randomIndex];
}

/**
 * 漢字を画像に変換する
 * @param kanji 漢字
 * @param size 画像サイズ (デフォルト: 512x512)
 * @param backgroundColor 背景色 (デフォルト: 白。PNGの場合は透明)
 * @param textColor テキスト色 (デフォルト: 黒)
 * @param fontFamily フォント (デフォルト: 力強い毛筆フォント)
 * @param imageFormat 画像形式 ('jpg' または 'png')
 * @returns 画像のData URL
 */
export function kanjiToImage(
  kanji: string,
  size: number = 512,
  backgroundColor: string = '#ffffff',
  textColor: string = '#000000',
  fontFamily: string = 'Yuji Mai',
  imageFormat: 'jpg' | 'png' = 'png'
): string {
  // キャンバス要素を作成
  const canvas = document.createElement('canvas');
  canvas.width = size;
  canvas.height = size;
  
  const ctx = canvas.getContext('2d');
  if (!ctx) {
    throw new Error('Canvas context could not be created');
  }
  
  // 背景を描画（PNG形式で透明にする場合は背景を描画しない）
  if (imageFormat === 'jpg' || backgroundColor !== 'transparent') {
    ctx.fillStyle = backgroundColor;
    ctx.fillRect(0, 0, size, size);
  }
  
  // 漢字を描画
  ctx.fillStyle = textColor;
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  
  // 漢字のサイズを調整 (キャンバスサイズの約70%)
  const fontSize = Math.floor(size * 0.7);
  ctx.font = `${fontSize}px ${fontFamily}`;
  
  // 漢字を中央に描画
  ctx.fillText(kanji, size / 2, size / 2);
  
  // Data URLとして返す
  const mimeType = imageFormat === 'jpg' ? 'image/jpeg' : 'image/png';
  return canvas.toDataURL(mimeType, 0.95);
}

/**
 * 画像をダウンロードする
 * @param dataUrl 画像のData URL
 * @param format ファイル形式 ('jpg' または 'png')
 * @param kanji 漢字 (ファイル名に使用)
 */
export function downloadImage(dataUrl: string, format: 'jpg' | 'png', kanji: string): void {
  // ダウンロード用のリンク要素を作成
  const link = document.createElement('a');
  
  // Data URLを設定
  link.href = dataUrl;
  
  // ファイル名を設定
  const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
  link.download = `kanji-${kanji}-${timestamp}.${format}`;
  
  // クリックイベントをシミュレート
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

/**
 * 指定された形式で画像をダウンロードする
 * @param kanji 漢字
 * @param format 形式 ('jpg' または 'png')
 */
export function downloadKanjiImage(kanji: string, format: 'jpg' | 'png'): void {
  // PNG形式の場合は透明背景、JPGの場合は白背景
  const backgroundColor = format === 'png' ? 'transparent' : '#ffffff';
  const image = kanjiToImage(kanji, 512, backgroundColor, '#000000', 'Yuji Mai', format);
  downloadImage(image, format, kanji);
} 